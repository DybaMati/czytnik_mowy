<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rozpoznawanie cyfr – grupy w wierszach + powtarzanie</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; background: #f4f6f9; }
        h1 { color: #2c3e50; }
        #tabela { width: 90%; max-width: 800px; margin: 30px auto; border-collapse: collapse; background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #tabela th { background: #3498db; color: white; padding: 15px; font-size: 24px; }
        #tabela td { padding: 15px; font-size: 48px; font-weight: bold; letter-spacing: 6px; text-align: center; border-bottom: 1px solid #eee; }
        button { padding: 15px 30px; font-size: 20px; margin: 15px; cursor: pointer; border: none; border-radius: 8px; color: white; }
        #start { background: #27ae60; }
        #start:hover { background: #219a52; }
        #stop { background: #e74c3c; }
        #stop:hover { background: #c0392b; }
        #status { font-size: 22px; margin: 20px; font-weight: bold; }
        .info { max-width: 800px; margin: 20px auto; padding: 15px; background: #ecf0f1; border-radius: 8px; text-align: left; }
    </style>
</head>
<body>
    <h1>Rozpoznawanie grup cyfr</h1>
    <p>Mów grupy cyfr (np. „pięćdziesiąt dziewięć czterdzieści dwa”), zrób krótką przerwę – doda się jako nowy wiersz i zostanie powtórzony na głos.</p>
    <p><strong>F12 → Console</strong> – zobaczysz pełne logi.</p>

    <button id="start">Rozpocznij nasłuchiwanie</button>
    <button id="stop">Zatrzymaj</button>
    
    <div id="status">Status: Gotowy</div>
    
    <table id="tabela">
        <thead>
            <tr>
                <th>Zapisane grupy cyfr</th>
            </tr>
        </thead>
        <tbody id="rows">
            <!-- Wiersze będą dodawane tutaj -->
        </tbody>
    </table>

    <div class="info">
        <strong>Przykład działania:</strong><br>
        Mówisz: „pięćdziesiąt dziewięć czterdzieści dwa” → przerwa → dodaje wiersz <strong>5942</strong> i mówi na głos: „pięć dziewięć cztery dwa” (szybko, rate 1.8)<br><br>
        Potem: „dwadzieścia trzy piętnaście” → dodaje <strong>2315</strong> i powtarza tę grupę.
    </div>

    <script>
        if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
            alert('Twoja przeglądarka nie obsługuje rozpoznawania mowy!');
        }

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'pl-PL';
        recognition.continuous = true;
        recognition.interimResults = true;

        const tbody = document.getElementById('rows');

        // Mapa cyfr na polskie słowa do odczytu
        const digitToPolish = {
            '0': 'zero', '1': 'jeden', '2': 'dwa', '3': 'trzy', '4': 'cztery',
            '5': 'pięć', '6': 'sześć', '7': 'siedem', '8': 'osiem', '9': 'dziewięć'
        };

        function speakGroup(group) {
            if (!group) return;
            const words = [];
            for (let digit of group) {
                words.push(digitToPolish[digit]);
            }
            const text = words.join(' ');
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'pl-PL';
            utter.rate = 1.8; // szybkie powtarzanie
            speechSynthesis.speak(utter);
            console.log('%cODCZYTANO NA GŁOS:', 'color: #e67e22; font-weight: bold;', text);
        }

        function extractDigits(transcript) {
            console.log('%cSurowy tekst:', 'color: #3498db; font-weight: bold;', transcript);
            const clean = transcript.trim();
            const onlyDigits = clean.replace(/[^0-9]/g, '');
            if (onlyDigits) {
                console.log('%cZnaleziono cyfry bezpośrednio:', 'color: #e67e22;', onlyDigits);
            }
            console.log('%cWyodrębnione cyfry z frazy:', 'color: #27ae60; font-weight: bold;', onlyDigits || '(brak)');
            return onlyDigits;
        }

        recognition.onresult = (event) => {
            let finalGroup = '';

            for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                const digits = extractDigits(transcript);

                if (event.results[i].isFinal && digits) {
                    finalGroup = digits;
                }
            }

            // Jeśli mamy nową potwierdzoną grupę
            if (finalGroup) {
                // Dodaj nowy wiersz do tabeli
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.textContent = finalGroup;
                row.appendChild(cell);
                tbody.appendChild(row);

                console.log('%cDODANO NOWĄ GRUPĘ DO TABELI:', 'color: #9b59b6; font-size: 18px; font-weight: bold;', finalGroup);

                // Powtórz na głos tylko tę nową grupę
                speakGroup(finalGroup);
            }
        };

        recognition.onerror = (event) => {
            console.error('Błąd:', event.error);
            document.getElementById('status').textContent = 'Błąd: ' + event.error;
            document.getElementById('status').style.color = 'red';
        };

        recognition.onstart = () => {
            console.log('%cNASŁUCHIWANIE ROZPOCZĘTE', 'color: #27ae60; font-size: 18px; font-weight: bold;');
            document.getElementById('status').textContent = 'Nasłuchiwanie aktywne – mów grupy cyfr!';
            document.getElementById('status').style.color = '#27ae60';
        };

        recognition.onend = () => {
            console.log('%cNasłuchiwanie zatrzymane', 'color: #e74c3c;');
            document.getElementById('status').textContent = 'Nasłuchiwanie zatrzymane';
        };

        document.getElementById('start').onclick = () => {
            tbody.innerHTML = ''; // wyczyść tabelę
            console.clear();
            console.log('%c=== NOWA SESJA ===', 'color: #f1c40f; font-size: 22px; font-weight: bold; background: #2c3e50; padding: 10px;');
            recognition.start();
        };

        document.getElementById('stop').onclick = () => {
            recognition.stop();
        };
    </script>
</body>
</html>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
