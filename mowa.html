<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nasluchiwanie cyfr - uniwersalnie</title>
<style>
body{font-family:Arial;padding:20px;}
button{font-size:18px;padding:12px 20px;margin-top:10px;z-index:1001;position:relative;}
table{border-collapse:collapse;margin-top:20px;width:100%;}
th,td{border:1px solid #000;padding:10px;font-size:22px;text-align:center;}
#lock{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:1000;touch-action:none;}
#lock span{color:#fff;font-size:20px;position:absolute;bottom:30px;width:100%;text-align:center;}
#info{font-size:18px;margin-top:10px;color:#222;}
.new-row{background:#cfc;transition:background 1s;}
</style>
</head>
<body>

<h2>Nasluchiwanie cyfr uniwersalnie</h2>
<button id="toggle">ðŸŽ™ START</button>
<button id="unlock" style="display:none;">â›” STOP</button>
<p id="info">Kliknij START aby rozpoczÄ…Ä‡ nagrywanie.</p>

<div id="lock"><span>Ekran zablokowany â€“ nagrywanie aktywne</span></div>

<table id="table">
<tr><th>#</th><th>Numer</th></tr>
</table>

<script>
let counter=1;
let listening=false;
let wakeLock=null;
const table=document.getElementById("table");
const toggleBtn=document.getElementById("toggle");
const unlockBtn=document.getElementById("unlock");
const lockDiv=document.getElementById("lock");
const info=document.getElementById("info");

const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SpeechRecognition){info.textContent="Twoja przeglÄ…darka nie wspiera rozpoznawania mowy.";}
else{
  const recognition=new SpeechRecognition();
  recognition.lang="pl-PL";
  recognition.continuous=false; // krÃ³tkie frazy, mobilnie dziaÅ‚a lepiej
  recognition.interimResults=false;

  async function enableWakeLock(){try{wakeLock=await navigator.wakeLock.request("screen");}catch(e){console.log("WakeLock error",e);}}
  function disableWakeLock(){if(wakeLock){wakeLock.release();wakeLock=null;}}

  toggleBtn.onclick=async ()=>{
    if(!listening){
      startRecognition();
      listening=true;
      toggleBtn.style.display="none";
      unlockBtn.style.display="inline-block";
      lockDiv.style.display="block";
      await enableWakeLock();
      info.textContent="Nagrywanieâ€¦ mÃ³w cyfry po 2.";
    }
  };

  unlockBtn.onclick=()=>{
    recognition.stop();
    listening=false;
    toggleBtn.style.display="inline-block";
    unlockBtn.style.display="none";
    lockDiv.style.display="none";
    disableWakeLock();
    info.textContent="Nagrywanie zatrzymane.";
  };

  function speakFeedback(text){if('speechSynthesis' in window){const u=new SpeechSynthesisUtterance(text);window.speechSynthesis.speak(u);}}

  function addDigits(digits){
    for(let i=0;i<digits.length;i+=4){
      const chunk=digits.slice(i,i+4);
      while(chunk.length<4) chunk.push("-");
      const row=table.insertRow();
      row.insertCell().textContent=counter++;
      row.insertCell().textContent=chunk.join("");
      row.classList.add("new-row");
      setTimeout(()=>row.classList.remove("new-row"),1000);
      info.textContent="Zapisano numer: "+chunk.join("");
      speakFeedback("Zapisano numer: "+chunk.join(""));
    }
  }

  recognition.onresult=(event)=>{
    const text=event.results[0][0].transcript.trim();
    console.log("Rozpoznano:",text);
    const digits=text.replace(/\D/g,'').split('');
    console.log("WyciÄ…gniÄ™te cyfry:",digits);
    if(digits.length===0){info.textContent="Brak cyfr â€“ powtÃ³rz nagranie";speakFeedback("Brak cyfr, powtÃ³rz nagranie");}
    else addDigits(digits);
  };

  recognition.onerror=(e)=>{info.textContent="BÅ‚Ä…d: "+e.error; console.log("BÅ‚Ä…d:",e.error);};

  recognition.onend=()=>{
    if(listening) setTimeout(startRecognition,200); // restart krÃ³tkiej frazy mobilnie
  };

  function startRecognition(){recognition.start();}
}
</script>

</body>
</html>
44444
