<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rozpoznawanie cyfr – wersja na iPhone</title>
    <style>
        body { font-family: -apple-system, Arial, sans-serif; text-align: center; margin-top: 50px; background: #f4f6f9; -webkit-user-select: none; }
        h1 { color: #2c3e50; }
        #tabela { width: 90%; max-width: 800px; margin: 30px auto; border-collapse: collapse; background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden; }
        #tabela th { background: #3498db; color: white; padding: 20px; font-size: 24px; }
        #tabela td { padding: 20px; font-size: 56px; font-weight: bold; letter-spacing: 8px; text-align: center; border-bottom: 1px solid #eee; }
        button { padding: 18px 36px; font-size: 22px; margin: 20px; cursor: pointer; border: none; border-radius: 12px; color: white; font-weight: bold; }
        #start { background: #27ae60; }
        #start:hover { background: #219a52; }
        #stop { background: #e74c3c; }
        #stop:hover { background: #c0392b; }
        #status { font-size: 24px; margin: 30px; font-weight: bold; min-height: 60px; }
        .info { max-width: 800px; margin: 20px auto; padding: 20px; background: #fff3cd; border-radius: 12px; text-align: left; font-size: 18px; border: 1px solid #ffeaa7; }
        .warning { color: #d63031; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Rozpoznawanie grup cyfr</h1>
    <p>Mów grupy cyfr z krótkimi przerwami (np. „pięćdziesiąt dziewięć czterdzieści dwa”).</p>

    <button id="start">Rozpocznij nasłuchiwanie</button>
    <button id="stop">Zatrzymaj</button>
    
    <div id="status">Status: Gotowy</div>
    
    <table id="tabela">
        <thead>
            <tr>
                <th>Zapisane grupy cyfr</th>
            </tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>

    <div class="info">
        <strong>Na iPhonie:</strong><br>
        • Używaj <strong>Safari</strong> – tam działa najlepiej (rozpoznawanie + głośne powtarzanie).<br>
        • W Chrome na iOS rozpoznawanie mowy niestety nie działa.<br><br>
        <span class="warning">Po kliknięciu „Rozpocznij” – zezwól na mikrofon i dotknij ekranu, jeśli nie słyszysz głosu.</span>
    </div>

    <script>
        const tbody = document.getElementById('rows');
        const statusEl = document.getElementById('status');

        // Sprawdź wsparcie dla rozpoznawania mowy
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            statusEl.textContent = 'Twoja przeglądarka nie wspiera rozpoznawania mowy!';
            statusEl.style.color = '#d63031';
            document.getElementById('start').disabled = true;
            alert('Użyj Safari na iPhonie – tam działa rozpoznawanie mowy!');
        }

        const recognition = new SpeechRecognition();
        recognition.lang = 'pl-PL';
        recognition.continuous = true;
        recognition.interimResults = true;

        const digitToPolish = {
            '0': 'zero', '1': 'jeden', '2': 'dwa', '3': 'trzy', '4': 'cztery',
            '5': 'pięć', '6': 'sześć', '7': 'siedem', '8': 'osiem', '9': 'dziewięć'
        };

        function speakGroup(group) {
            if (!group) return;
            const words = group.split('').map(d => digitToPolish[d]);
            const text = words.join(' ');
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'pl-PL';
            utter.rate = 1.8;

            // Pomoc na iOS – próbujemy odblokować audio
            utter.onstart = () => console.log('Mówię:', text);
            utter.onerror = (e) => console.error('Błąd mowy:', e);

            speechSynthesis.speak(utter);
        }

        function extractDigits(transcript) {
            return transcript.trim().replace(/[^0-9]/g, '');
        }

        recognition.onresult = (event) => {
            let finalGroup = '';

            for (let i = event.resultIndex; i < event.results.length; i++) {
                const digits = extractDigits(event.results[i][0].transcript);
                if (event.results[i].isFinal && digits) {
                    finalGroup = digits;
                }
            }

            if (finalGroup) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.textContent = finalGroup;
                row.appendChild(cell);
                tbody.appendChild(row);

                speakGroup(finalGroup);
                statusEl.textContent = `Dodano: ${finalGroup} (powtórzono na głos)`;
                statusEl.style.color = '#27ae60';
            }
        };

        recognition.onerror = (event) => {
            console.error('Błąd rozpoznawania:', event.error);
            if (event.error === 'not-allowed') {
                statusEl.textContent = 'Brak dostępu do mikrofonu!';
                statusEl.style.color = '#d63031';
            }
        };

        recognition.onstart = () => {
            statusEl.textContent = 'Nasłuchiwanie aktywne – mów grupy cyfr!';
            statusEl.style.color = '#27ae60';
        };

        recognition.onend = () => {
            statusEl.textContent = 'Nasłuchiwanie zatrzymane';
            statusEl.style.color = '#7f8c8d';
        };

        document.getElementById('start').onclick = () => {
            tbody.innerHTML = '';
            statusEl.textContent = 'Przygotowuję...';
            // Mały trik na iOS – odblokowanie audio po dotknięciu
            const utter = new SpeechSynthesisUtterance('');
            speechSynthesis.speak(utter);
            recognition.start();
        };

        document.getElementById('stop').onclick = () => {
            recognition.stop();
        };
    </script>
</body>
</html>44444444444444444444444444444444444444444ggg
