<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rozpoznawanie cyfr głosowo</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
        #tabela { width: 80%; margin: 20px auto; border-collapse: collapse; }
        #tabela th, #tabela td { border: 1px solid #ccc; padding: 10px; }
        #cyfry { font-size: 48px; font-weight: bold; }
        button { padding: 10px 20px; font-size: 18px; margin: 10px; }
        #status { font-size: 20px; margin: 20px; }
    </style>
</head>
<body>
    <h1>Rozpoznawanie cyfr mówionych</h1>
    <p>Mów cyfry po dwie (np. "pięć cztery", "cztery pięć") z krótkimi przerwami. Skrypt będzie łączył je w ciąg (np. 5445) i odczytywał na głos co dwie cyfry.</p>
    
    <button id="start">Rozpocznij nasłuchiwanie</button>
    <button id="stop">Zatrzymaj</button>
    
    <div id="status">Status: Gotowy</div>
    
    <table id="tabela">
        <thead>
            <tr>
                <th>Zapisane cyfry</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="cyfry"></td>
            </tr>
        </tbody>
    </table>

    <script>
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'pl-PL'; // Język polski
        recognition.continuous = true;
        recognition.interimResults = true;

        let finalDigits = '';
        let lastSpokenIndex = 0; // Indeks do śledzenia, które pary już odczytano

        const polishToDigit = {
            'zero': '0', 'jeden': '1', 'dwa': '2', 'trzy': '3', 'cztery': '4',
            'pięć': '5', 'sześć': '6', 'siedem': '7', 'osiem': '8', 'dziewięć': '9'
        };

        function extractDigits(transcript) {
            const words = transcript.toLowerCase().trim().split(/\s+/);
            let digits = '';
            for (let word of words) {
                if (polishToDigit[word]) {
                    digits += polishToDigit[word];
                }
            }
            return digits;
        }

        function speakPairs() {
            const newPairsLength = Math.floor(finalDigits.length / 2);
            const newPairsStart = lastSpokenIndex;

            if (newPairsLength > newPairsStart) {
                const toSpeak = finalDigits.substring(newPairsStart * 2, newPairsLength * 2);
                const pairs = toSpeak.match(/.{2}/g) || [];
                pairs.forEach(pair => {
                    const first = pair[0];
                    const second = pair[1] || '';
                    const words = [digitToPolish(first)];
                    if (second) words.push(digitToPolish(second));

                    const utter = new SpeechSynthesisUtterance(words.join(' '));
                    utter.lang = 'pl-PL';
                    utter.rate = 1.8; // Szybkość 1.8
                    speechSynthesis.speak(utter);
                });
                lastSpokenIndex = newPairsLength;
            }
        }

        const digitToPolish = {
            '0': 'zero', '1': 'jeden', '2': 'dwa', '3': 'trzy', '4': 'cztery',
            '5': 'pięć', '6': 'sześć', '7': 'siedem', '8': 'osiem', '9': 'dziewięć'
        };

        recognition.onresult = (event) => {
            let interim = '';
            let final = finalDigits;

            for (let i = event.resultIndex; i < event.results.length; i++) {
                const res = event.results[i][0].transcript.trim();
                const digits = extractDigits(res);

                if (event.results[i].isFinal) {
                    final += digits;
                } else {
                    interim += digits;
                }
            }

            const display = final + interim;
            document.getElementById('cyfry').textContent = display || '—';

            if (final.length > finalDigits.length) {
                finalDigits = final;
                speakPairs();
            }
        };

        recognition.onerror = (event) => {
            document.getElementById('status').textContent = 'Błąd: ' + event.error;
        };

        recognition.onend = () => {
            document.getElementById('status').textContent = 'Nasłuchiwanie zatrzymane';
        };

        document.getElementById('start').onclick = () => {
            recognition.start();
            document.getElementById('status').textContent = 'Nasłuchiwanie aktywne... Mów cyfry!';
        };

        document.getElementById('stop').onclick = () => {
            recognition.stop();
        };
    </script>
    <p><strong>Uwaga:</strong> Rozpoznawanie mowy (mikrofon) działa w pełni tylko w przeglądarkach opartych na Chromium (Google Chrome, Edge, Opera). W Safari rozpoznawanie mowy jest ograniczone lub niedostępne. Odczytywanie na głos działa w Chrome i Safari.</p>
</body>
</html>vvvvvvvvvvvvvvvvvvvvvvvvvv
