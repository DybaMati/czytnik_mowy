<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NasÅ‚uchiwanie cyfr uniwersalne</title>
<style>
body{font-family:Arial;padding:20px;}
button{font-size:18px;padding:12px 20px;margin-top:10px;z-index:1001;position:relative;}
table{border-collapse:collapse;margin-top:20px;width:100%;}
th,td{border:1px solid #000;padding:10px;font-size:22px;text-align:center;}
#lock{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:1000;touch-action:none;}
#lock span{color:#fff;font-size:20px;position:absolute;bottom:30px;width:100%;text-align:center;}
#info{font-size:18px;margin-top:10px;color:#222;}
.new-row{background:#cfc;transition:background 1s;}
</style>
</head>
<body>

<h2>NasÅ‚uchiwanie cyfr uniwersalne</h2>
<button id="toggle">ðŸŽ™ START</button>
<button id="unlock" style="display:none;">â›” STOP</button>
<p id="info">Kliknij START, aby rozpoczÄ…Ä‡ nagrywanie i powiedz cyfry po dwie.</p>

<div id="lock"><span>Ekran zablokowany â€“ nagrywanie aktywne</span></div>

<table id="table">
<tr><th>#</th><th>Numer</th></tr>
</table>

<script>
let counter=1;
let listening=false;
let wakeLock=null;
const table=document.getElementById("table");
const toggleBtn=document.getElementById("toggle");
const unlockBtn=document.getElementById("unlock");
const lockDiv=document.getElementById("lock");
const info=document.getElementById("info");

const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SpeechRecognition){
    info.textContent="Twoja przeglÄ…darka nie wspiera rozpoznawania mowy.";
} else {
    const recognition=new SpeechRecognition();
    recognition.lang="pl-PL";
    recognition.interimResults=false;

    // Desktop = continuous, Mobilnie = false
    const isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    recognition.continuous=!isMobile;

    async function enableWakeLock(){try{wakeLock=await navigator.wakeLock.request("screen");}catch(e){console.log("WakeLock error",e);}}
    function disableWakeLock(){if(wakeLock){wakeLock.release();wakeLock=null;}}

    toggleBtn.onclick=async ()=>{
        if(!listening){
            recognition.start();
            listening=true;
            toggleBtn.style.display="none";
            unlockBtn.style.display="inline-block";
            lockDiv.style.display="block";
            await enableWakeLock();
            info.textContent="Nagrywanieâ€¦ powiedz cyfry po dwie (np. 'jedenaÅ›cie dwadzieÅ›cia trzy')";
        }
    };

    unlockBtn.onclick=()=>{
        recognition.stop();
        listening=false;
        toggleBtn.style.display="inline-block";
        unlockBtn.style.display="none";
        lockDiv.style.display="none";
        disableWakeLock();
        info.textContent="Nagrywanie zatrzymane.";
    };

    // zamiana sÅ‚Ã³w na cyfry (proste mapowanie dla 0-20,30,40,...90)
    const wordToDigit={
        "zero":"0","jeden":"1","dwa":"2","trzy":"3","cztery":"4","piÄ™Ä‡":"5","piec":"5","szeÅ›Ä‡":"6","szesc":"6","siedem":"7","osiem":"8","dziewiÄ™Ä‡":"9",
        "dziesiÄ™Ä‡":"10","jedenaÅ›cie":"11","dwanaÅ›cie":"12","trzynaÅ›cie":"13","czternaÅ›cie":"14","piÄ™tnaÅ›cie":"15","pietnascie":"15",
        "szesnaÅ›cie":"16","szesnascie":"16","siedemnaÅ›cie":"17","osiemnaÅ›cie":"18","dziewiÄ™tnaÅ›cie":"19","dziewietnascie":"19",
        "dwadzieÅ›cia":"20","trzydzieÅ›ci":"30","czterdzieÅ›ci":"40","piÄ™Ä‡dziesiÄ…t":"50","piecdziesiat":"50","szeÅ›Ä‡dziesiÄ…t":"60","szescdziesiat":"60","siedemdziesiÄ…t":"70",
        "osiemdziesiÄ…t":"80","dziewiÄ™Ä‡dziesiÄ…t":"90","dziewiecdziesiat":"90"
    };

    function wordsToDigits(text){
        const words=text.toLowerCase().split(/\s+/);
        const digits=[];
        for(let w of words){
            if(wordToDigit[w]) digits.push(wordToDigit[w]);
        }
        return digits;
    }

    function addDigits(digits){
        if(digits.length===0){info.textContent="Nie rozpoznano cyfr, powtÃ³rz nagranie"; return;}
        let combined=digits.join('');
        while(combined.length<4) combined+="-";
        const row=table.insertRow();
        row.insertCell().textContent=counter++;
        row.insertCell().textContent=combined;
        row.classList.add("new-row");
        setTimeout(()=>row.classList.remove("new-row"),1000);
        info.textContent="Dodano numer: "+combined;
        // feedback gÅ‚osowy: wypowiada same cyfry
        if('speechSynthesis' in window){
            let speakStr=digits.join(' ');
            window.speechSynthesis.speak(new SpeechSynthesisUtterance(speakStr));
        }
    }

    recognition.onresult=(event)=>{
        const text=event.results[0][0].transcript.trim();
        console.log("Rozpoznano frazÄ™:",text);
        const digits=wordsToDigits(text);
        console.log("WyciÄ…gniÄ™te cyfry:",digits);
        addDigits(digits);
    };

    recognition.onerror=(e)=>{info.textContent="BÅ‚Ä…d: "+e.error; console.log("BÅ‚Ä…d:",e.error);};

    recognition.onend=()=>{
        if(listening) setTimeout(()=>recognition.start(), isMobile?300:0);
    };
}
</script>

</body>
</html>
77777
